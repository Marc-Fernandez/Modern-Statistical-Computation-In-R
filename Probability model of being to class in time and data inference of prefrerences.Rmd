---
title: "PS5_Fernándezi_Marc"
output:
  html_document:
    df_print: paged
---

PS done in collaboration with Pere Carboneras and Sergi Romano


## Problem 2: Choosing a company

Some friends are close to completing their studies and are interested in their future in the labor market. They have gathered samples of wages in several different companies. The obviously fictional data for this problem can be generated by the following code:

```{r}

set.seed(1)
n <- 1e3
x <- list()
x[[1]] <- rchisq(n, 1)*100+100
x[[2]] <- abs(rnorm(n,20,100))+100
x[[3]] <- abs(rnorm(n,0,1))+runif(n,100,260)
x[[4]] <- rpois(n, .8)^1.2*100+100
lwages <- lapply(1:length(x), function(i) data.frame(wage=x[[i]], company=i))
wages <- do.call("rbind", lwages)

```

Samples are assumed to be representative of wages in each company for workers with the same studies as the friends in this problem in different points of their careers, and the way of collecting the samples and measure wages makes the data comparable across companies. It’s assumed that new recruits get some of the lowest wages and tend to progress upwards. Wages are measured in an arbitrary unit with is the same for all companies.

Study the data how you see fit in order to decide which company you would prefer to work, and help the students which company is the better fit for each one. Support your answer with graphical or numerical summaries of the data.

a. Student A has great expectations about his future career. Whichever company he might join, he expects to quickly climb the ranks to the top of the company.
b. Student B still doesn’t have long term plans. His priority is to get the best possible wages in the short term.
c. Student C sees himself as an average performer.
d. Student D thinks that he needs a wage about 240 units to support the way of life he wants, so he would choose the company with the maximum probability of getting at least that amount.

```{r fig.height = 10}
company.1 <- lwages[[1]][["wage"]]
company.2 <- lwages[[2]][["wage"]]
company.3 <- lwages[[3]][["wage"]]
company.4 <- lwages[[4]][["wage"]]

par(mfrow = c(2,1))

plot(
     wages$wage, 
     wages$company, 
     main = "Scatterplot of wage distribution per company", 
     xlab = "wage", 
     ylab = "company"
  )

boxplot(
     company.1, 
     company.2, 
     company.3, 
     company.4, 
     main = "Boxplot of wage distribution per company", 
     xlab = "wage", 
     ylab = "company", 
     horizontal = TRUE, 
     col = c("tomato", "lightblue", "lightgreen", "orange")
)
```
```{r}
cbind(
  quantile(company.1, c(seq(0,1,0.1))), 
  quantile(company.2, c(seq(0,1,0.1))),
  quantile(company.3, c(seq(0,1,0.1))),
  quantile(company.4, c(seq(0,1,0.1)))
  )
```


As per the scatterplot, boxplot and quantilic decomposition above:

*  Student A's preferences will change depending on his expectations. These are his prefered companies depending on the percentiles he expects to rank, according to the highest wage in every percentile.

  |  Percentile              |Prefered company|
  |--------------------------|----------------|
  |  0 - 49th percentile     | company 3      |
  |  50th - 70th percentile  | company 4      |
  |  71th - 100th percentile | company 1      |


* Student B will prefer company 3, as it has the highest wage for an entry level job (we ignore the 0th percentile wage in company 2, as it is only the highest wage from the 0th to the 1th percentile).

* Student C will try to get into company 4, as it has the highest wage for the 50% percentile, i.e. a median wage of 200 units.

* Student D will prefer company 1, as it is the company where he needs to rank the lowest to get to 240 units.

# Exercise 3: Is Laura on time?

Laura’s class starts at 9:00 am. She sets her clock alarm at 7:00 am. The time in minutes it takes her to leave home since the alarm sounds is distributed by N(45,4)
. The time she needs to walk to the station follows a N(10,1)
 distribution. Trains at her station pass at minutes 7, 17, 27, 37, 47 and 57 every hour (that is, there is a train at 7: 57, another at 8:07, and so). The train journey takes 30 minutes if the train works properly. 3% of days there is some problem with the train and the journey may take any time between 30 minutes and 1 hour (assume a uniform distribution). The time in minutes to walk from the station to class follows a N(10,2)
 distribution.

Estimate the probability that Laura arrives to class on time.

Indication: Normal distributions are notated N(μ,σ)
 (that is, standard deviation is shown, not variance).

Suggestion: Although R has some data types to manage time, it’s often simpler to just use numbers by setting a starting point and a time unit. For example, you can use minutes before 9:00 am.

```{r}

time.to.get.to.class <- function() {
  leave.home <- rnorm(1, 45, 4)
  walk.from.house.to.station <- rnorm(1, 10, 1)
  train.schedule <- seq(7, by = 10, length.out = 40)
  
  next.train <- train.schedule[length(train.schedule[train.schedule < (leave.home + walk.from.house.to.station)]) + 1]
  
  arrival.time.to.station <- (leave.home - walk.from.house.to.station)
  
  time.waiting.for.train <-  next.train - arrival.time.to.station
  
  if (runif(1,0,1) > 0.97) {
    train.journey <- runif(1, 30, 60)
  } else {
    train.journey <- 30
  }
  
  walk.from.station.to.class <- rnorm(1, 10, 2)
  
  total.time <- leave.home + walk.from.house.to.station + time.waiting.for.train + train.journey + walk.from.station.to.class
  
  return(total.time)
}

arrival.tracking <- c()
for (i in 1:100000){
  arrival.tracking <- c(arrival.tracking, time.to.get.to.class())
}

sum(arrival.tracking <= 120) / length(arrival.tracking)

# OR length(arrival.tracking[arrival.tracking < 120]) / length(arrival.tracking)
```

The probability that she arrives on time is about a 58.93% after running a Monte-Carlo simulation. Note, however, that we are saying that if she's a few seconds late, she is considered to be late (in a random monte-carlo it's about a 8.1k cases out of 100k)

```{r}
hist(arrival.tracking)
```